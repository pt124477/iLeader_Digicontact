import e from'./../../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import r from'./../../../../external/@swc/helpers/src/_object_spread.mjs.js';import o from'./../../../../external/@swc/helpers/src/_object_spread_props.mjs.js';import t from"../../../token.js";import n from"../../../../utils/query-string.js";import{apiResponse as s}from"../../../../utils/response.js";import{PAYMENT_H5_URL as a,PAYMENT_APIS as d,APP_ID as i}from"../../../../constants.js";import p from"../openWebview.js";import{__generator as c}from'./../../../../external/tslib/tslib.es6.js';var m,u=(m=e((function(e,m,u,l,h){var f,w,j,_,R,g,b,I,y,S,P,v,A;return c(this,(function(c){switch(c.label){case 0:f=i,(w=new URLSearchParams).append("amount",e.toString()),w.append("item",encodeURIComponent(JSON.stringify(m))),w.append("appId",f),u&&w.append("desc",encodeURIComponent(u)),l&&w.append("extradata",encodeURIComponent(JSON.stringify(l))),h&&w.append("method",h),j={headers:{"Content-Type":"application/x-www-form-urlencoded",authorization:"Bearer "}},c.label=1;case 1:return c.trys.push([1,6,,7]),[4,t.getAccessToken().catch((function(){throw s.error.loginRequired}))];case 2:return _=c.sent(),j.headers.authorization="Bearer ".concat(_),[4,fetch(d.CREATE_ORDER,o(r({method:"POST"},j),{body:w}))];case 3:return[4,c.sent().json()];case 4:if(!(R=c.sent()).data||0!==R.err)throw s.error.badRequest(R.msg);return g=R.data.id,b=R.data.jwt,I=window.APP_VERSION,y=window.APP_ENV,S={miniAppId:f,orderId:g},b&&(S.token=b),I&&(S.version=I),y&&(S.env=y),h&&(S.method=h),P=n.encode(S),v=new URL("?".concat(P),a).toString(),[4,p(v)];case 5:return c.sent(),[2,{orderId:g}];case 6:throw A=c.sent(),console.log("Internal error"),A;case 7:return[2]}}))})),function(e,r,o,t,n){return m.apply(this,arguments)});export{u as default};
